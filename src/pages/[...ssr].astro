---
import { AppEntry } from './_app/entry'
import { handleSsrRequest } from './_app/handleSsrRequest'
import RootLayout from './_layout.astro'

export const prerender = false

const result = await handleSsrRequest(Astro)

if (result instanceof Response) {
  return result
}

const { getServerRouter, scriptHtml } = result

const shouldNotHydrate = Astro.url.pathname.replace('.html', '').endsWith('-no-hydration')
---

<RootLayout>
  {
    shouldNotHydrate ? (
      <AppEntry getServerRouter={getServerRouter} />
    ) : (
      <Fragment>
        <AppEntry client:load getServerRouter={getServerRouter} />
        <Fragment set:html={scriptHtml} />
      </Fragment>
    )
  }
</RootLayout>
